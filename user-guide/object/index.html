<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="base-url" content="http://venusplus.cn/">
    <link type="image/png" href="/images/head.png" rel="shortcut icon" />
    <base href="http://venusplus.cn/">
    <link rel="stylesheet" href="css/main.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_18677_3gesaak2gctyb9.css">
    <link href="css/default.css" rel="stylesheet">
    <link href="css/vendor/antd.min.css" rel="stylesheet">
    <link href="css/vendor/swiper.min.css" rel="stylesheet">
    <title>Venus中间件-Object 数据存储</title>
    <script src="js/vendor/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/common.min.js" type="text/javascript" charset="utf-8"></script>
    <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">

  </head>
  <body data-url="/user-guide/object/" class="theme">
    
<div class="header">
  <div>
    <div class="header-wrapper">
      <div class="header-logo">
        <a href=/>
          <img src="/images/logo.png" alt="">
        </a>
      </div>
      <ul class="sofa-menu ant-menu ant-menu-horizontal ant-menu-light ant-menu-root" role="menu">
        
          <li class="ant-menu-item sofa-menu-item  ">
              
              <div class="sofa-menu-item-text">
                
                  <a href="/">首页</a>
                
                
                
              </div>
          </li>
        
          <li class="ant-menu-item sofa-menu-item  ">
              
              <div class="product-menu">
                <div class="product-menu-wrapper">
                  
                    <div class="product-menu-col">
                      <div class="product-menu-title">快速开发框架</div>
                      
                        <a href=/product/venus class="product-menu-title-link">Venus</a>
                      
                        <a href=/product/venusboot class="product-menu-title-link">Venus Boot</a>
                      
                    </div>
                  
                    <div class="product-menu-col">
                      <div class="product-menu-title">微服务框架</div>
                      
                        <a href=/product/venus-cloud class="product-menu-title-link">Venus Cloud</a>
                      
                    </div>
                  
                    <div class="product-menu-col">
                      <div class="product-menu-title">经典中间件</div>
                      
                        <a href=/product/talos class="product-menu-title-link">Talos网关</a>
                      
                    </div>
                  
                    <div class="product-menu-col">
                      <div class="product-menu-title">数据中间件</div>
                      
                        <a href=/product/venus-dts class="product-menu-title-link">Venus DTS</a>
                      
                    </div>
                  
                    <div class="product-menu-col">
                      <div class="product-menu-title">工具和公共类库</div>
                      
                        <a href=/product/venus-codegen class="product-menu-title-link">Venus CodeGen</a>
                      
                    </div>
                  
                </div>
              </div>
              
              <div class="sofa-menu-item-text">
                
                  <a href="javascript:;">产品</a>
                
                
                
              </div>
          </li>
        
          <li class="ant-menu-item sofa-menu-item  ">
              
              <div class="sofa-menu-item-text">
                
                  <a href="/#">文档</a>
                
                
                
              </div>
          </li>
        
          <li class="ant-menu-item sofa-menu-item  ">
              
              <div class="sofa-menu-item-text">
                
                  <a href="/#">控制台</a>
                
                
                
              </div>
          </li>
        
          <li class="ant-menu-item sofa-menu-item  ">
              
              <div class="sofa-menu-item-text">
                
                  <a href="/#">关于我们</a>
                
                
                
              </div>
          </li>
        

      </ul>
      <div class="sofa-menu-right pull-right">
       
        <div class="search">
          <span class="ant-input-group-wrapper" style="width: 262px;">
            <span class="ant-input-wrapper ant-input-group">
              
              <span class="ant-input-search ant-input-affix-wrapper">
                <form class="search-form" action=/search method="get">
                    <input type="text" name="q" placeholder="请输入搜索内容" value="" class="ant-input" autocomplete="off" />
                    <input type="hidden" name="title" value="新人上手">
                </form>
                <span class="ant-input-suffix">
                  <i class="anticon anticon-search ant-input-search-icon"></i>
                </span>
              </span>
            </span>
          </span>
        </div>

       
        
      </div>
    </div>
  </div>
</div>

    <div class="main">
      
  
  
    <div class="pg-artical " id="pg-artical">
      <div class="wrap">
        
<div class="nav-section">
  <div class="navbar">
    <span class="larkicon larkicon-toc"></span>
  </div>
  <nav class="nav-container">
    <ul class="catalog">
      
        
        <li class="current-book">
          <span class="name">新人上手3</span>
          <div class="liebiao-wrapper">
            
              <i id="title-liebiao-icon" class="title-liebiao-icon iconfont icon-liebiao"></i>
            

            <div class="docs-map">
              <div class="docs-map-wrapper">
                
                  
                  <div class="docs-map-item">
                    <div>
                      <h3 class="title">开发框架</h3>
                      
                        <div class="docs-map-item-link-wrapper">
                          <a class="docs-map-item-link" href="/#">Venus Framework</a>
                        </div>
                      
                    </div>
                  </div>
                  
                
                  
                  <div class="docs-map-item">
                    <div>
                      <h3 class="title">微服务框架</h3>
                      
                        <div class="docs-map-item-link-wrapper">
                          <a class="docs-map-item-link" href="/twa">Venus Cloud</a>
                        </div>
                      
                    </div>
                  </div>
                  
                
                  
                  <div class="docs-map-item">
                    <div>
                      <h3 class="title">中间件</h3>
                      
                        <div class="docs-map-item-link-wrapper">
                          <a class="docs-map-item-link" href="/talos">Talos网关</a>
                        </div>
                      
                    </div>
                  </div>
                  
                
                  
                  <div class="docs-map-item">
                    <div>
                      <h3 class="title">数据库中间件</h3>
                      
                        <div class="docs-map-item-link-wrapper">
                          <a class="docs-map-item-link" href="/venus-dts">DTS</a>
                        </div>
                      
                    </div>
                  </div>
                  
                
                  
                  <div class="docs-map-item">
                    <div>
                      <h3 class="title">工具类</h3>
                      
                        <div class="docs-map-item-link-wrapper">
                          <a class="docs-map-item-link" href="/venus-codegen">CodeGen</a>
                        </div>
                      
                    </div>
                  </div>
                  
                
                  
                  <div class="docs-map-item">
                    <div>
                      <h3 class="title">帮助中心</h3>
                      
                        <div class="docs-map-item-link-wrapper">
                          <a class="docs-map-item-link" href="/user-guide">新人上手</a>
                        </div>
                      
                    </div>
                  </div>
                  
                
              </div>
            </div>
          </div>

        </li>
        
          <li class="nav-item depth1   " data-currentPath="1" data-rootPath="1"><a href="user-guide/readme" class="">
              简介
            </a></li>
        
          <li class="nav-item depth1   " data-currentPath="2" data-rootPath="2"><a href="user-guide/product-application-intro" class="">
              产品与应用
            </a></li>
        
          <li class="nav-item depth1   " data-currentPath="3" data-rootPath="3"><a href="user-guide/sprint-intro" class="">
              应用研发
            </a></li>
        
          <li class="nav-item depth1   " data-currentPath="4" data-rootPath="4"><a href="user-guide/service-intro" class="">
              服务
            </a></li>
        
      
    </ul>
  </nav>
</div>

        <div class="main-container">
          <div id="page-toc"></div>
          <div class="artical-section larksite">
    <div class="doc-article">
      <article class="doc-article-inner">
        <div class="typo">
          <h1 class="typo-title" itemprop="title">
          Object 数据存储
          </h1>
          <p class="meta">更新时间: <span>2017-7-14</span></p>
          <div class="typo-content">
            <p><h2 id="简介"><a class="anchor" href="#%E7%AE%80%E4%BB%8B"><span class="octicon octicon-link"></span></a> 简介</h2>
<p>basement.object 提供了一个 schema free 的对象存储解决方案。</p>
<h2 id="api-文档"><a class="anchor" href="#api-%E6%96%87%E6%A1%A3"><span class="octicon octicon-link"></span></a> API 文档</h2>
<p><a href="http://basement-jssdk.alipay.com/api/object.html" target="_blank" rel="noopener"><a href="http://basement-jssdk.alipay.com/api/object.html">http://basement-jssdk.alipay.com/api/object.html</a></a></p>
<h2 id="命令行工具"><a class="anchor" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7"><span class="octicon octicon-link"></span></a> 命令行工具</h2>
<p><a href="http://web.npm.alibaba-inc.com/package/@alipay/basement-cli" target="_blank" rel="noopener"><a href="http://web.npm.alibaba-inc.com/package/@alipay/basement-cli">http://web.npm.alibaba-inc.com/package/@alipay/basement-cli</a></a></p>
<h2 id="对象"><a class="anchor" href="#%E5%AF%B9%E8%B1%A1"><span class="octicon octicon-link"></span></a> 对象</h2>
<p>所有存储到 basement Object 的数据都可以看做是一个个的对象，我们在存储数据之前是不需要定义这个对象的具体数据结构的。<br />
每一个对象都包含若干键值对（key-value)，属性值是 JSON 格式兼容的数据（string, boolean, number, object, array, null)。</p>
<h3 id="格式"><a class="anchor" href="#%E6%A0%BC%E5%BC%8F"><span class="octicon octicon-link"></span></a> 格式</h3>
<ul>
<li>所有的对象和键值对的 key 都必须以英文字母开头，有效的字符仅限在英文字母、数字以及下划线。</li>
<li>有部分保留字段，键值对的 key 不能够使用。
<ul>
<li><code>objectId</code>：基于 objectId 来进行对象的更新、删除等操作。</li>
<li><code>createdAt</code>：对象的创建时间，创建时会自动赋值，不需要自行修改。</li>
<li><code>updatedAt</code>：对象的最近一次更新时间，每次修改对象时会自动修改。</li>
</ul>
</li>
<li>键值对的值中有一类特殊的类型：<code>{<strong>type: &lsquo;pointer&rsquo;}</code>，如果有键值对的值是一个 hash 对象，且有 <code></strong>type</code> 字段，将会当做 basement 的特殊对象处理。现在 basement 的特殊字段有 <code>pointer</code>, <code>date</code> 和 <code>regex</code> 三个类型。</li>
</ul>
<h3 id="特殊值"><a class="anchor" href="#%E7%89%B9%E6%AE%8A%E5%80%BC"><span class="octicon octicon-link"></span></a> 特殊值</h3>
<p>上面提到，当键值对的值为特定的 <code>{<strong>type: &lsquo;pointer&rsquo;}</code> 类型时，即为 basement 内置的特殊类型。</p>
<h4 id="pointer"><a class="anchor" href="#pointer"><span class="octicon octicon-link"></span></a> pointer</h4>
<p>pointer 类型是用来指向另一个对象的值使用的，它包含了 <code>className</code> 和 <code>objectId</code> 两个属性，用来提取目标对象，我们拿一个例子来说明：</p>
<pre><code class="lang-js hljs raw">{
  <span class="hljs-attr"></strong>type</span>: <span class="hljs-string">&lsquo;pointer&rsquo;</span>,
  <span class="hljs-attr">className</span>: <span class="hljs-string">&lsquo;Author&rsquo;</span>,
  <span class="hljs-attr">objectId</span>: <span class="hljs-string">&lsquo;55a39634e4b0ed48f0c1845c&rsquo;</span>,
}
</code></pre>
<p>上面的这个指定对象就指向了 <code>Author</code> 类的一个对象，我们可以将这个指针对象插入到其他的数据字段中（例如 <code>Blog</code> 对象中的 author 字段），后面我们可以在查询 <code>Blog</code> 的时候通过 include 的方式将 author 也提取出来。</p>
<p>我们可以通过 <code>object.pointer()</code> 方法来快速创建一个 pointer 对象：</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">let</span> author = object.pointer(<span class="hljs-string">&lsquo;Author&rsquo;</span>, <span class="hljs-string">&lsquo;55a39634e4b0ed48f0c1845c&rsquo;</span>);
<span class="hljs-comment">// author === { __type: &lsquo;pointer&rsquo;, className: &lsquo;Author&rsquo;, objectId: &lsquo;55a39634e4b0ed48f0c1845c&rsquo; }</span>
<span class="hljs-keyword">const</span> Author = object.class(<span class="hljs-string">&lsquo;Author&rsquo;</span>);
author = Author.pointer(<span class="hljs-string">&lsquo;55a39634e4b0ed48f0c1845c&rsquo;</span>);
<span class="hljs-comment">// author === { <strong>type: &lsquo;pointer&rsquo;, className: &lsquo;Author&rsquo;, objectId: &lsquo;55a39634e4b0ed48f0c1845c&rsquo; }</span>
</code></pre>
<h4 id="date"><a class="anchor" href="#date"><span class="octicon octicon-link"></span></a> date</h4>
<p>由于 JSON 传递 Date 类型时会格式化成 ISO String，因此我们通过定义一个特殊的 basement date 类型来表示是一个 date 类型，它包含了 <code>iso</code> 属性，是一个 ISO String 格式的日期字符串。</p>
<pre><code class="lang-js hljs raw">{
  <span class="hljs-attr"></strong>type</span>: <span class="hljs-string">&lsquo;date&rsquo;</span>,
  <span class="hljs-attr">iso</span>: <span class="hljs-string">&lsquo;2016-06-12T10:42:37.630Z&rsquo;</span>
}
</code></pre>
<p>我们可以通过 <code>object.date()</code> 方法将一个 js 中的 Date 对象包装成一个 basement 的 date 对象：</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> date = object.date(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());
<span class="hljs-comment">// date === { <strong>type: &lsquo;date&rsquo;, iso: &lsquo;2016-06-12T10:42:37.630Z&rsquo; }</span>
</code></pre>
<p>在涉及到 date 对象的创建和查询的时候，都以这样的形式进行传递：</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> date = object.date(<span class="hljs-string">&lsquo;2012-01-01&rsquo;</span>);
<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">yield</span> object.find(<span class="hljs-string">&lsquo;TestObject&rsquo;</span>, {
  <span class="hljs-attr">where</span>: {
    <span class="hljs-attr">createdAt</span>: { <span class="hljs-attr">$gt</span>: date },
  },
});
</code></pre>
<p>object 默认生成的 <code>createdAt</code> 和 <code>updatedAt</code> 都是 date 类型。</p>
<h4 id="regex"><a class="anchor" href="#regex"><span class="octicon octicon-link"></span></a> regex</h4>
<p>由于 JSON 在序列化正则表达式时默认会被序列化成一个空对象，因此我们通过定义一个 basement regex 类型来传递正则。它包含了一个 <code>source</code> 属性和 <code>flags</code> 属性，<code>flags</code> 属性可以为空，也就是 js 中 <code>new RegExp(source, flags)</code> 中的参数。</p>
<pre><code class="lang-js hljs raw">{
  <span class="hljs-attr"></strong>type</span>: <span class="hljs-string">&lsquo;regex&rsquo;</span>,
  <span class="hljs-attr">source</span>: <span class="hljs-string">&rsquo;<sup class="footnote-ref" id="fnref:a-z"><a rel="footnote" href="#fn:a-z">1</a></sup>\d+$&rsquo;</span>,
  <span class="hljs-attr">flags</span>: <span class="hljs-string">&lsquo;i&rsquo;</span>,
}
</code></pre>
<p>在 js-sdk 中，所有传递给服务端的正则表达式都会被自动序列化成 basement 的 regex 格式。</p>
<h3 id="创建对象"><a class="anchor" href="#%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1"><span class="octicon octicon-link"></span></a> 创建对象</h3>
<p>例如我们要实现一个简单的博客系统，需要存储博文和作者，我们可以创建一个 <code>Blog</code> 类和一个 <code>Author</code> 类，往里面插入对象：</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> object = <span class="hljs-keyword">new</span> Basement(config).object;</p>

<p><span class="hljs-keyword">const</span> Blog = obejct.class(<span class="hljs-string">&lsquo;Blog&rsquo;</span>);
<span class="hljs-keyword">const</span> Author = object.class(<span class="hljs-string">&lsquo;Author&rsquo;</span>);</p>

<p><span class="hljs-keyword">const</span> author = Author.create({
  <span class="hljs-attr">name</span>: <span class="hljs-string">&lsquo;作者名&rsquo;</span>,
});</p>

<p><span class="hljs-keyword">const</span> blog = {
  <span class="hljs-attr">title</span>: <span class="hljs-string">&lsquo;博客标题&rsquo;</span>,
  <span class="hljs-attr">content</span>: <span class="hljs-string">&lsquo;博客内容&rsquo;</span>,
  <span class="hljs-attr">category</span>: <span class="hljs-string">&lsquo;类别&rsquo;</span>,
  <span class="hljs-attr">author</span>: Author.pointer(author),
  <span class="hljs-attr">likes</span>: <span class="hljs-number">100</span>,
};
<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">yield</span> Blog.create(blog);
<span class="hljs-comment">// 或者直接通过 object 调用</span>
<span class="hljs-comment">// const res = yield object.create(&lsquo;Blog&rsquo;, blog);</span>
<span class="hljs-comment">// 后面所有的对象操作方法都可以直接通过 object 对象进行操作，第一个参数为类名</span>
</code></pre>
<h4 id="返回"><a class="anchor" href="#%E8%BF%94%E5%9B%9E"><span class="octicon octicon-link"></span></a> 返回</h4>
<p>如果创建成功，将会返回一个对象，包含 <code>createdAt</code> 和 <code>objectId</code> 两个字段。<code>objectId</code> 即是这个对象创建的唯一 id，后续对这个对象的任何修改都需要基于此 id。</p>
<pre><code class="lang-js hljs raw">{
  <span class="hljs-attr">createdAt</span>: <span class="hljs-string">&lsquo;2016-05-07T14:11:49.065Z&rsquo;</span>,
  <span class="hljs-attr">objectId</span>: <span class="hljs-string">&lsquo;57231b0ca13eab6245a76dd2&rsquo;</span>,
}
</code></pre>
<p>如果创建对象出现异常，都会抛出异常，所有的异常都有 <code>code</code> 这个字段，可以用 code 到<a href>错误码详解</a> 中查询到详细的错误原因和解决方案（后面的所有接口异常处理都相同）。</p>
<p><strong><em>注意：创建对象的方法包括后面提到的所有对对象的操作方法都是一个 <code>generatorFunction</code>。</em></strong></p>
<h3 id="导入对象"><a class="anchor" href="#%E5%AF%BC%E5%85%A5%E5%AF%B9%E8%B1%A1"><span class="octicon octicon-link"></span></a> 导入对象</h3>
<p>和创建对象非常类似，不同点是支持指定：</p>
<ul>
<li>objectId 24位 hex 字符串</li>
<li>createdAt ISO date string</li>
<li>updatedAt ISO date string</li>
</ul>
<p>三个字段。</p>
<p><strong><em>请只在迁移数据到 basement 的时候才调用 import，一般情况下都使用 create。不要滥用 API～</em></strong></p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> object = <span class="hljs-keyword">new</span> Basement(config).object;</p>

<p><span class="hljs-keyword">const</span> Blog = obejct.class(<span class="hljs-string">&lsquo;Blog&rsquo;</span>);
<span class="hljs-keyword">const</span> Author = object.class(<span class="hljs-string">&lsquo;Author&rsquo;</span>);</p>

<p><span class="hljs-keyword">const</span> author = Author.import({
  <span class="hljs-attr">objectId</span>: <span class="hljs-string">&lsquo;573adfb82482c019714a0dcb&rsquo;</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">&lsquo;作者名&rsquo;</span>,
  <span class="hljs-attr">createdAt</span>: <span class="hljs-string">&lsquo;2012-12-30T20:10:22.222222-08:00&rsquo;</span>,
  <span class="hljs-attr">updatedAt</span>: <span class="hljs-string">&lsquo;2012-12-30T20:12:22.222222-08:00&rsquo;</span>,
});</p>

<p><span class="hljs-keyword">const</span> blog = {
  <span class="hljs-attr">objectId</span>: <span class="hljs-string">&lsquo;573adfb82482c019714a0dcb&rsquo;</span>,
  <span class="hljs-attr">title</span>: <span class="hljs-string">&lsquo;博客标题&rsquo;</span>,
  <span class="hljs-attr">content</span>: <span class="hljs-string">&lsquo;博客内容&rsquo;</span>,
  <span class="hljs-attr">category</span>: <span class="hljs-string">&lsquo;类别&rsquo;</span>,
  <span class="hljs-attr">author</span>: Author.pointer(author),
  <span class="hljs-attr">likes</span>: <span class="hljs-number">100</span>,
  <span class="hljs-attr">createdAt</span>: <span class="hljs-string">&lsquo;2012-12-30T20:10:22.222222-08:00&rsquo;</span>,
  <span class="hljs-attr">updatedAt</span>: <span class="hljs-string">&lsquo;2012-12-30T20:12:22.222222-08:00&rsquo;</span>,
};
<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">yield</span> Blog.import(blog);
<span class="hljs-comment">// 或者直接通过 object 调用</span>
<span class="hljs-comment">// const res = yield object.import(&lsquo;Blog&rsquo;, blog);</span>
<span class="hljs-comment">// 后面所有的对象操作方法都可以直接通过 object 对象进行操作，第一个参数为类名</span>
</code></pre>
<h4 id="返回-1"><a class="anchor" href="#%E8%BF%94%E5%9B%9E-1"><span class="octicon octicon-link"></span></a> 返回</h4>
<p>如果导入成功，将会返回一个对象，包含 <code>createdAt</code> 和 <code>objectId</code> 两个字段。<code>objectId</code> 即是这个对象创建的唯一 id，后续对这个对象的任何修改都需要基于此 id。</p>
<pre><code class="lang-js hljs raw">{
  <span class="hljs-attr">createdAt</span>: <span class="hljs-string">&lsquo;2012-12-30T20:10:22.222222-08:00&rsquo;</span>,
  <span class="hljs-attr">objectId</span>: <span class="hljs-string">&lsquo;57231b0ca13eab6245a76dd2&rsquo;</span>,
}
</code></pre>
<p>如果导入对象出现异常，都会抛出异常，所有的异常都有 <code>code</code> 这个字段，可以用 code 到<a href>错误码详解</a> 中查询到详细的错误原因和解决方案（后面的所有接口异常处理都相同）。</p>
<h3 id="检索对象"><a class="anchor" href="#%E6%A3%80%E7%B4%A2%E5%AF%B9%E8%B1%A1"><span class="octicon octicon-link"></span></a> 检索对象</h3>
<p>往 basement 中插入数据是很简单的，获取数据也非常容易，如果事先知道 <code>objectId</code> 的话，可以通过 <code>object.get</code> 方法提取出整个对象。<br />
同时可以通过 <code>fields</code> 选项提取出自己需要的字段，通过 <code>include</code> 选项将关联的 pointer 对象展开。</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> Blog = object.class(<span class="hljs-string">&lsquo;Blog&rsquo;</span>);
<span class="hljs-keyword">const</span> blog = <span class="hljs-keyword">yield</span> Blog.get(blogId, {
  <span class="hljs-attr">fields</span>: <span class="hljs-string">&lsquo;title,content,author&rsquo;</span>, <span class="hljs-comment">// 指定值需要这三个字段</span>
  include: <span class="hljs-string">&lsquo;author&rsquo;</span>, <span class="hljs-comment">// 指定将 author 字段展开</span>
});
</code></pre>
<ul>
<li><code>fields</code> 配置支持反向选择，刚才这个例子，如果我们设置 <code>fields</code> 字段为 <code>-likes</code>，将会返回对象除了 <code>likes</code> 之外的所有字段。</li>
<li><code>include</code> 指定的字段必须是一个 <code>pointer</code> 对象（或者为空），否则会抛出异常。</li>
</ul>
<h4 id="返回-2"><a class="anchor" href="#%E8%BF%94%E5%9B%9E-2"><span class="octicon octicon-link"></span></a> 返回</h4>
<p>查询成功将返回 objectId 对应的对象。</p>
<pre><code class="lang-js hljs raw">{
  <span class="hljs-attr">objectId</span>: <span class="hljs-string">&lsquo;57231b0ca13eab6245a76dd2&rsquo;</span>,
  <span class="hljs-attr">title</span>: <span class="hljs-string">&lsquo;hello basement&rsquo;</span>,
  <span class="hljs-attr">content</span>: <span class="hljs-string">&lsquo;basement quick start&rsquo;</span>,
  <span class="hljs-attr">author</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">&lsquo;busi.hyy&rsquo;</span>,
    <span class="hljs-attr">createdAt</span>: <span class="hljs-string">&lsquo;2016-05-07T14:11:49.065Z&rsquo;</span>,
    <span class="hljs-attr">objectId</span>: <span class="hljs-string">&lsquo;57231b0ca13eab6245a76ddx&rsquo;</span>,
  },
}
</code></pre>
<p>如果这个 objectId 对应的对象不存在，将会返回 <code>null</code>。<br />
查询失败将抛出一个异常。</p>
<h3 id="查询对象"><a class="anchor" href="#%E6%9F%A5%E8%AF%A2%E5%AF%B9%E8%B1%A1"><span class="octicon octicon-link"></span></a> 查询对象</h3>
<p>除了上面提到的通过 <code>objectId</code> 来检索一个对象之外，我们还可以通过提供条件来进行查询。</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> Blog = object.class(<span class="hljs-string">&lsquo;Blog&rsquo;</span>);
<span class="hljs-keyword">const</span> blogs = <span class="hljs-keyword">yield</span> Blog.find({
  <span class="hljs-attr">where</span>: {
    <span class="hljs-attr">likes</span>: { <span class="hljs-string">&rsquo;$gt&rsquo;</span>: <span class="hljs-number">10</span> },
  },
  <span class="hljs-attr">fields</span>: <span class="hljs-string">&lsquo;title,likes,author&rsquo;</span>,
  <span class="hljs-attr">include</span>: <span class="hljs-string">&lsquo;author&rsquo;</span>,
  <span class="hljs-attr">sort</span>: <span class="hljs-string">&lsquo;updatedAt&rsquo;</span>,
  <span class="hljs-attr">limit</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">skip</span>: <span class="hljs-number">10</span>,
});
</code></pre>
<h4 id="查询参数"><a class="anchor" href="#%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="octicon octicon-link"></span></a> 查询参数</h4>
<ul>
<li>where：查询条件，支持 <a href="https://docs.mongodb.org/manual/tutorial/query-documents/" target="_blank" rel="noopener">mongodb 支持的查询类型</a>，包括 <code>$in</code>, <code>$gt</code>, <code>$or</code> 等操作符。</li>
<li>fields: 返回的字段，和检索对象一样，也支持反向。</li>
<li>include: 和检索对象一致，将关联的 pointer 对象展开。</li>
<li>sort: 按照字段进行排序，前面加 <code>-</code> 即是倒序，支持多个字段排序（<code>updatedAt,title</code>)。</li>
<li>limit: 限制取回的条数，默认为 100，最大值为 1000。</li>
<li>skip: 跳过的条数。</li>
</ul>
<h4 id="关联查询"><a class="anchor" href="#%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2"><span class="octicon octicon-link"></span></a> 关联查询</h4>
<p>basement 中通过 pointer 来提供简单的关联查询，但是复杂的关联查询暂时只能通过多次调用查询接口完成。</p>
<h4 id="返回-3"><a class="anchor" href="#%E8%BF%94%E5%9B%9E-3"><span class="octicon octicon-link"></span></a> 返回</h4>
<p>调用 <code>find</code> 方法返回的是匹配这次查询的对象数组。</p>
<pre><code class="lang-js hljs raw">[{
  <span class="hljs-attr">objectId</span>: <span class="hljs-string">&lsquo;57231b0ca13eab6245a76dd1&rsquo;</span>,
  <span class="hljs-attr">title</span>: <span class="hljs-string">&lsquo;hello&rsquo;</span>,
  <span class="hljs-attr">like</span>: <span class="hljs-number">100</span>,
  <span class="hljs-attr">author</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">&lsquo;busi.hyy&rsquo;</span>,
    <span class="hljs-attr">createdAt</span>: <span class="hljs-string">&lsquo;2016-05-07T14:11:49.065Z&rsquo;</span>,
    <span class="hljs-attr">objectId</span>: <span class="hljs-string">&lsquo;57231b0ca13eab6245a76ddx&rsquo;</span>,
  },
}, {
  <span class="hljs-attr">objectId</span>: <span class="hljs-string">&lsquo;57231b0ca13eab6245a76dd2&rsquo;</span>,
  <span class="hljs-attr">title</span>: <span class="hljs-string">&lsquo;basement&rsquo;</span>,
  <span class="hljs-attr">like</span>: <span class="hljs-number">200</span>,
  <span class="hljs-attr">author</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">&lsquo;busi.hyy&rsquo;</span>,
    <span class="hljs-attr">createdAt</span>: <span class="hljs-string">&lsquo;2016-05-07T14:11:49.065Z&rsquo;</span>,
    <span class="hljs-attr">objectId</span>: <span class="hljs-string">&lsquo;57231b0ca13eab6245a76ddx&rsquo;</span>,
  },
}]
</code></pre>
<p>如果没有任何匹配到的数据，会返回一个空数组。<br />
查询失败将抛出一个异常。</p>
<h3 id="查询单个对象"><a class="anchor" href="#%E6%9F%A5%E8%AF%A2%E5%8D%95%E4%B8%AA%E5%AF%B9%E8%B1%A1"><span class="octicon octicon-link"></span></a> 查询单个对象</h3>
<p>通过 <code>findOne</code> 查询得到一个对象，相当于 <code>find</code> 限制一条数据的结果 。</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> Blog = object.class(<span class="hljs-string">&lsquo;Blog&rsquo;</span>);
<span class="hljs-keyword">const</span> blogs = <span class="hljs-keyword">yield</span> Blog.findOne({
  <span class="hljs-attr">where</span>: {
    <span class="hljs-attr">likes</span>: { <span class="hljs-string">&rsquo;$gt&rsquo;</span>: <span class="hljs-number">10</span> },
  },
  <span class="hljs-attr">fields</span>: <span class="hljs-string">&lsquo;title,likes,author&rsquo;</span>,
  <span class="hljs-attr">include</span>: <span class="hljs-string">&lsquo;author&rsquo;</span>,
  <span class="hljs-attr">sort</span>: <span class="hljs-string">&lsquo;updatedAt&rsquo;</span>,
});
</code></pre>
<h4 id="查询参数-1"><a class="anchor" href="#%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0-1"><span class="octicon octicon-link"></span></a> 查询参数</h4>
<ul>
<li>where：查询条件，支持 <a href="https://docs.mongodb.org/manual/tutorial/query-documents/" target="_blank" rel="noopener">mongodb 支持的查询类型</a>，包括 <code>$in</code>, <code>$gt</code>, <code>$or</code> 等操作符。</li>
<li>fields: 返回的字段，和检索对象一样，也支持反向。</li>
<li>include: 和检索对象一致，将关联的 pointer 对象展开。</li>
<li>sort: 按照字段进行排序，前面加 <code>-</code> 即是倒序，支持多个字段排序（<code>updatedAt,title</code>)。</li>
</ul>
<h4 id="关联查询-1"><a class="anchor" href="#%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-1"><span class="octicon octicon-link"></span></a> 关联查询</h4>
<p>basement 中通过 pointer 来提供简单的关联查询，但是复杂的关联查询暂时只能通过多次调用查询接口完成。</p>
<h4 id="返回-4"><a class="anchor" href="#%E8%BF%94%E5%9B%9E-4"><span class="octicon octicon-link"></span></a> 返回</h4>
<p>调用 <code>findOne</code> 方法返回的是匹配这次查询的对象。</p>
<pre><code class="lang-js hljs raw">{
  <span class="hljs-attr">objectId</span>: <span class="hljs-string">&lsquo;57231b0ca13eab6245a76dd1&rsquo;</span>,
  <span class="hljs-attr">title</span>: <span class="hljs-string">&lsquo;hello&rsquo;</span>,
  <span class="hljs-attr">like</span>: <span class="hljs-number">100</span>,
  <span class="hljs-attr">author</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">&lsquo;busi.hyy&rsquo;</span>,
    <span class="hljs-attr">createdAt</span>: <span class="hljs-string">&lsquo;2016-05-07T14:11:49.065Z&rsquo;</span>,
    <span class="hljs-attr">objectId</span>: <span class="hljs-string">&lsquo;57231b0ca13eab6245a76ddx&rsquo;</span>,
  },
}
</code></pre>
<p>如果没有任何匹配到的数据，会返回 <code>null</code>。<br />
查询失败将抛出一个异常。</p>
<h3 id="对象计数"><a class="anchor" href="#%E5%AF%B9%E8%B1%A1%E8%AE%A1%E6%95%B0"><span class="octicon octicon-link"></span></a> 对象计数</h3>
<p>通过 <code>count</code> 方法，可以获取到这个类一共创建的多少实例，同时 <code>count</code> 方法支持 <code>where</code> 查询。</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> Blog = object.class(<span class="hljs-string">&lsquo;Blog&rsquo;</span>);
<span class="hljs-keyword">const</span> nums = <span class="hljs-keyword">yield</span> Blog.count({
  <span class="hljs-attr">where</span>: {
    <span class="hljs-attr">likes</span>: { <span class="hljs-string">&rsquo;$gt&rsquo;</span>: <span class="hljs-number">10</span> },
  },
});
</code></pre>
<h4 id="查询参数-2"><a class="anchor" href="#%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0-2"><span class="octicon octicon-link"></span></a> 查询参数</h4>
<ul>
<li>where：查询条件，支持 <a href="https://docs.mongodb.org/manual/tutorial/query-documents/" target="_blank" rel="noopener">mongodb 支持的查询类型</a>，包括 <code>$in</code>, <code>$gt</code>, <code>$or</code> 等操作符。</li>
</ul>
<h4 id="返回-5"><a class="anchor" href="#%E8%BF%94%E5%9B%9E-5"><span class="octicon octicon-link"></span></a> 返回</h4>
<p>查询成功返回计数结果：</p>
<pre><code class="lang-js hljs raw">{
  <span class="hljs-attr">count</span>: <span class="hljs-number">10</span>,
}
</code></pre>
<p>如果查询的对象不存在，返回的 count 为 0。<br />
查询报错会抛出一个异常。</p>
<h3 id="更新对象"><a class="anchor" href="#%E6%9B%B4%E6%96%B0%E5%AF%B9%E8%B1%A1"><span class="octicon octicon-link"></span></a> 更新对象</h3>
<p>更新对象和检索对象一样，首先要拿到对象的 <code>objectId</code>，之后便可以根据这个 id 进行数据的修改。</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> Blog = object.class(<span class="hljs-string">&lsquo;Blog&rsquo;</span>);
<span class="hljs-keyword">const</span> blog = <span class="hljs-keyword">yield</span> Blog.update(blogId, {
  <span class="hljs-attr">content</span>: <span class="hljs-string">&lsquo;new content&rsquo;</span>,
  <span class="hljs-attr">likes</span>: { <span class="hljs-attr"><strong>op</span>: <span class="hljs-string">&lsquo;increase&rsquo;</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> },
});
</code></pre>
<p>更新操作只会影响指定的这些字段，我们除了直接覆盖式更新这些字段之外，还提供了一系列操作符来进行更新。</p>
<h4 id="操作符"><a class="anchor" href="#%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="octicon octicon-link"></span></a> 操作符</h4>
<p>对于传递给 <code>update</code> 的更新对象，basement 支持多种操作符。每一个操作符都是一个包含 <code></strong>op</code> 和 <code>value</code> 两个属性的对象，<code><strong>op</code> 支持下面的操作符：</p>
<ul>
<li><code>increase</code>: 计数功能，<code>value</code> 为增加的值，可以为负数</li>
<li><code>delete</code>: 将该字段删除</li>
<li><code>add</code>: 将 value 的所有元素添加到数组后面，value 必须为数组类型。</li>
<li><code>addUnique</code>: 将 value 的所有元素添加到数组后面，并整体进行去重，value 必须为数组类型。</li>
<li><code>remove</code>: 从数组中删除和 value 相等的所有元素。</li>
</ul>
<h4 id="返回-6"><a class="anchor" href="#%E8%BF%94%E5%9B%9E-6"><span class="octicon octicon-link"></span></a> 返回</h4>
<p>如果更新成功，会返回一个对象，包含一个字段 <code>updatedAt</code>。</p>
<pre><code class="lang-js hljs raw">{
  <span class="hljs-attr">updatedAt</span>: <span class="hljs-string">&lsquo;2016-05-07T14:11:49.065Z&rsquo;</span>,
}
</code></pre>
<p>如果更新的对象不存在，返回 <code>null</code>。<br />
更新失败会抛出一个异常。</p>
<h3 id="批量更新"><a class="anchor" href="#%E6%89%B9%E9%87%8F%E6%9B%B4%E6%96%B0"><span class="octicon octicon-link"></span></a> 批量更新</h3>
<p>basement 同时支持基于特定条件的批量更新操作。</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> Blog = object.class(<span class="hljs-string">&lsquo;Blog&rsquo;</span>);
<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">yield</span> Blog.updateBy({ <span class="hljs-attr">title</span>: <span class="hljs-string">&lsquo;specific title&rsquo;</span> }, {
  <span class="hljs-attr">content</span>: <span class="hljs-string">&lsquo;new content&rsquo;</span>,
  <span class="hljs-attr">likes</span>: { <span class="hljs-attr"></strong>op</span>: <span class="hljs-string">&lsquo;increase&rsquo;</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> },
}, {
  <span class="hljs-attr">multi</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">upsert</span>: <span class="hljs-literal">false</span>,
});
</code></pre>
<p>updateBy 除了 className 之外的第一个参数为查询条件，这里的查询条件和 <code>find</code> 时支持的一致，注意不需要写 <code>where</code>。<strong><em>特别注意：当查询条件为空时，会将所有记录全部更新掉</em></strong>，第二个参数为要更新的内容，和前面提到的更新对象时支持的一致。第三个参数为批量更新时支持的一些特殊参数，现在支持 <code>multi</code> 和 <code>upsert</code> 两个选项：</p>
<ul>
<li><code>multi</code>: 当设置为 true 时，所有命中该查询条件的记录都会被更新掉，当它为 false 时，将只会更新第一条记录。默认为 true。</li>
<li><code>upsert</code>: 当设置为 true 时，当查询未命中任何一条记录的时候，会以 update 为内容，插入一条新记录。默认为 false。</li>
</ul>
<h4 id="返回-7"><a class="anchor" href="#%E8%BF%94%E5%9B%9E-7"><span class="octicon octicon-link"></span></a> 返回</h4>
<p>如果更新成功，会返回一个对象，包含以下几个字段：</p>
<ol>
<li><code>updatedAt</code>: 更新时间。</li>
<li><code>count</code>: 更新的条数。</li>
<li><code>objectId</code>: 如果由 upsert 新建了一条记录，则会返回 objectId 字段。</li>
<li><code>createdAt</code>: 如果由 upsert 新建了一条记录，则会返回 createdAt 字段。</li>
</ol>
<pre><code class="lang-js hljs raw">{
  <span class="hljs-attr">updatedAt</span>: <span class="hljs-string">&lsquo;2016-05-07T14:11:49.065Z&rsquo;</span>,
  <span class="hljs-attr">count</span>: <span class="hljs-number">10</span>,
}
</code></pre>
<p>如果更新的查询条件未命中到任何一条记录，且未设置 <code>upsert</code> 为 <code>true</code>，则返回 <code>null</code>。<br />
更新失败会抛出一个异常。</p>
<h3 id="删除对象"><a class="anchor" href="#%E5%88%A0%E9%99%A4%E5%AF%B9%E8%B1%A1"><span class="octicon octicon-link"></span></a> 删除对象</h3>
<p>和检索、更新对象一样，必须通过 <code>objectId</code> 来删除一个对象。</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> Blog = object.class(<span class="hljs-string">&lsquo;Blog&rsquo;</span>);
<span class="hljs-keyword">yield</span> Blog.remove(blogId);
</code></pre>
<h4 id="返回-8"><a class="anchor" href="#%E8%BF%94%E5%9B%9E-8"><span class="octicon octicon-link"></span></a> 返回</h4>
<p>如果删除成功，会返回一个对象，包含一个字段 <code>deletedAt</code>。</p>
<pre><code class="lang-js hljs raw">{
  <span class="hljs-attr">deletedAt</span>: <span class="hljs-string">&lsquo;2016-05-07T14:11:49.065Z&rsquo;</span>,
}
</code></pre>
<p>如果删除的对象不存在，返回 <code>null</code>。<br />
删除失败会抛出一个异常。</p>
<h3 id="批量删除"><a class="anchor" href="#%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="octicon octicon-link"></span></a> 批量删除</h3>
<p>basement 支持基于特定条件的批量删除。</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> Blog = object.class(<span class="hljs-string">&lsquo;Blog&rsquo;</span>);
<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">yield</span> Blog.removeBy({ <span class="hljs-attr">title</span>: <span class="hljs-string">&lsquo;specific title&rsquo;</span> });
</code></pre>
<p>removeBy 的第一个参数为查询条件，这里的查询条件和 <code>find</code> 时支持的一致。<strong><em>特别注意：当查询条件为空对象时，会删除整个 collection 中的所有数据</em></strong>。</p>
<h4 id="返回-9"><a class="anchor" href="#%E8%BF%94%E5%9B%9E-9"><span class="octicon octicon-link"></span></a> 返回</h4>
<p>如果删除成功，会返回一个对象，包含以下几个字段：</p>
<ol>
<li><code>deletedAt</code>: 更新时间。</li>
<li><code>count</code>: 删除的条数。</li>
</ol>
<pre><code class="lang-js hljs raw">{
  <span class="hljs-attr">deletedAt</span>: <span class="hljs-string">&lsquo;2016-05-07T14:11:49.065Z&rsquo;</span>,
  <span class="hljs-attr">count</span>: <span class="hljs-number">10</span>,
}
</code></pre>
<p>如果删除的查询条件未命中任何一条记录，返回 <code>null</code>。<br />
删除失败会抛出一个异常。</p>
<h3 id="删除-class"><a class="anchor" href="#%E5%88%A0%E9%99%A4-class"><span class="octicon octicon-link"></span></a> 删除 Class</h3>
<p>删除整个 Class，包括数据和索引。</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> Blog = object.class(<span class="hljs-string">&lsquo;Blog&rsquo;</span>);
<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">yield</span> Blog.removeClass();
</code></pre>
<h4 id="返回-10"><a class="anchor" href="#%E8%BF%94%E5%9B%9E-10"><span class="octicon octicon-link"></span></a> 返回</h4>
<p>如果删除成功，会返回一个对象，包含以下字段：</p>
<ol>
<li><code>deletedAt</code>: 更新时间。</li>
</ol>
<pre><code class="lang-js hljs raw">{
  <span class="hljs-attr">deletedAt</span>: <span class="hljs-string">&lsquo;2016-05-07T14:11:49.065Z&rsquo;</span>,
}
</code></pre>
<p>如果要删除的 Class 不存在，返回 <code>null</code>。<br />
删除失败会抛出一个异常。</p>
<h3 id="对象列表"><a class="anchor" href="#%E5%AF%B9%E8%B1%A1%E5%88%97%E8%A1%A8"><span class="octicon octicon-link"></span></a> 对象列表</h3>
<p>通过 <code>object.listClasses</code> 来获取应用创建的<code>类</code>的名字列表。</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> classNames = <span class="hljs-keyword">yield</span> object.listClasses();
</code></pre>
<h4 id="返回-11"><a class="anchor" href="#%E8%BF%94%E5%9B%9E-11"><span class="octicon octicon-link"></span></a> 返回</h4>
<p>如果查询成功，会返回一个数组，包含了这个应用创建的所有<code>类</code>的名字列表。</p>
<pre><code class="lang-js hljs raw">[
  <span class="hljs-string">&lsquo;blog&rsquo;</span>,
  <span class="hljs-string">&lsquo;author&rsquo;</span>,
]
</code></pre>
<h2 id="索引"><a class="anchor" href="#%E7%B4%A2%E5%BC%95"><span class="octicon octicon-link"></span></a> 索引</h2>
<p>在数据量变大的时候，查询会变得越来越慢，这时我们就需要创建索引来加速查询。在给 object 创建索引之前，建议大家先行阅读 <a href="https://docs.mongodb.com/manual/indexes/" target="_blank" rel="noopener">mongodb 索引文档</a>。</p>
<h3 id="创建索引"><a class="anchor" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="octicon octicon-link"></span></a> 创建索引</h3>
<p>basement 支持创建下列类型的索引：</p>
<ul>
<li><code>Single Filed Indexes</code>：只有一个字段的索引。</li>
<li><code>Compound Indexes</code>：多个字段复合索引。注意：创建复合索引的时候，如果对 a,b,c 创建了一个复合索引，等价于创建了 <code>a</code> / <code>a,b</code> / <code>a,b,c</code> 三个索引，和 mysql 创建索引一样是有顺序的。</li>
<li><code>Multikey Indexes</code>：针对数组子项的索引。</li>
</ul>
<p>所有的这些索引类型都支持 <code>unique</code> 属性，也就是可以让它们变成唯一索引。上面描述的这些索引类型和属性可以在 <a href="https://docs.mongodb.com/manual/indexes/" target="_blank" rel="noopener">mongodb 索引文档</a>中找到。</p>
<p>我们可以通过 sdk 提供的 <code>createIndex</code> 方法来创建一个索引。createIndex 接受一个 object 做为参数：</p>
<ul>
<li><code>fields</code>: 要创建的索引字段，当 fields 内只有一个字段时，创建的为 <code>Single Filed Indexes</code>，如果包含多个字段，创建的为 <code>Compound Indexes</code>，如果字段内存储的是数组类型，则会创建一个 <code>Multikey Indexes</code>。</li>
<li><code>unique</code>: 是否为唯一索引，默认为 false。</li>
</ul>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> Blog = object.class(<span class="hljs-string">&lsquo;Blog&rsquo;</span>);
<span class="hljs-keyword">const</span> authorIndex = <span class="hljs-keyword">yield</span> Blog.createIndex({
  <span class="hljs-attr">fields</span>: { <span class="hljs-attr">author</span>: <span class="hljs-number">1</span> }, <span class="hljs-comment">// 1 或者 -1，代表创建索引时的排序方式</span>
});</p>

<p><span class="hljs-comment">// 创建唯一索引</span>
<span class="hljs-keyword">const</span> urlIndex = <span class="hljs-keyword">yield</span> Blog.createIndex({
  <span class="hljs-attr">fields</span>: { <span class="hljs-attr">url</span>: <span class="hljs-number">1</span> },
  <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>,
});</p>

<p><span class="hljs-comment">// 创建复合索引(Compound Indexes)</span>
<span class="hljs-keyword">const</span> urlIndex = <span class="hljs-keyword">yield</span> Blog.createIndex({
  <span class="hljs-attr">fields</span>: { <span class="hljs-attr">title</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">category</span>: <span class="hljs-number">-1</span> },
});</p>

<p><span class="hljs-comment">// tag 存储的内容是一个数组，例如 [&lsquo;web&rsquo;, &lsquo;node&rsquo;]</span>
<span class="hljs-comment">// 此时创建的索引就是 Multikey Indexes</span>
<span class="hljs-keyword">const</span> tagIndex = <span class="hljs-keyword">yield</span> Blog.createIndex({
  <span class="hljs-attr">fields</span>: { <span class="hljs-attr">tag</span>: <span class="hljs-number">1</span> },
});
</code></pre>
<h4 id="返回-12"><a class="anchor" href="#%E8%BF%94%E5%9B%9E-12"><span class="octicon octicon-link"></span></a> 返回</h4>
<p>如果创建索引成功，返回值为 <code>{name: &lsquo;author_1&rsquo;}</code> 格式的对象，包含了索引的名称(name)，如果有删除索引的需求，以这个索引名称为 key 来调用删除索引的接口即可。<br />
创建失败会抛出一个异常。</p>
<h3 id="查询索引"><a class="anchor" href="#%E6%9F%A5%E8%AF%A2%E7%B4%A2%E5%BC%95"><span class="octicon octicon-link"></span></a> 查询索引</h3>
<p>通过 <code>listIndexes</code> 方法可以查询这个对象上创建的所有索引。</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> Blog = object.class(<span class="hljs-string">&lsquo;Blog&rsquo;</span>);
<span class="hljs-keyword">const</span> indexes = <span class="hljs-keyword">yield</span> Blog.listIndexes();
</code></pre>
<h4 id="返回-13"><a class="anchor" href="#%E8%BF%94%E5%9B%9E-13"><span class="octicon octicon-link"></span></a> 返回</h4>
<p>如果查询索引成功，会返回一个数组：</p>
<pre><code>[
  { name : &lsquo;foo_1&rsquo;, unique: true },
  { name : &lsquo;foo_1<em>bar</em>-1&rsquo;, unique: false },
]
</code></pre>
<p>name 为索引的名字，unique 标明是否是唯一索引。</p>
<h3 id="删除索引"><a class="anchor" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="octicon octicon-link"></span></a> 删除索引</h3>
<p>通过 <code>removeIndex</code> 可以删除一个索引。</p>
<pre><code class="lang-js hljs raw"><span class="hljs-keyword">const</span> Blog = object.class(<span class="hljs-string">&lsquo;Blog&rsquo;</span>);
<span class="hljs-keyword">const</span> indexes = <span class="hljs-keyword">yield</span> Blog.removeIndex(<span class="hljs-string">&lsquo;foo_1&rsquo;</span>);
</code></pre>
<p>如果删除成功，会返回一个对象，包含一个字段 <code>deletedAt</code>。</p>
<pre><code class="lang-js hljs raw">{
  <span class="hljs-attr">deletedAt</span>: <span class="hljs-string">&lsquo;2016-05-07T14:11:49.065Z&rsquo;</span>,
}
</code></pre>
<p>如果删除的索引不存在，返回 <code>null</code>。<br />
删除失败会抛出一个异常。</p>
<h2 id="反馈"><a class="anchor" href="#%E5%8F%8D%E9%A6%88"><span class="octicon octicon-link"></span></a> 反馈</h2>
<p>文档很难理解？api 使用很不爽? 欢迎提 issue <a href="http://gitlab.alipay-inc.com/x-platform/misc/issues/new?issue%5Bassignee_id%5D=&amp;issue%5Bmilestone_id%5D=" target="_blank" rel="noopener">吐槽</a></p>
<p><a target="_blank" href="http://cp.alibaba.net/donates?id=572c3af1dbe2df9fd728fa33"><img src="http://cp.alibaba.net/projects/572c3af1dbe2df9fd728fa33/badge" /></a> 觉得不错? 果断打赏<br /><img width="150" src="http://cp.alibaba.net/projects/572c3af1dbe2df9fd728fa33/qr" /></p></p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:a-z">a-z <a class="footnote-return" href="#fnref:a-z"><sup>[return]</sup></a></li>
</ol>
</div>

          </div>
        </div>
      </article>
    </div>
  </div>
        </div>
      </div>
    </div>
    <div class="mask hidden"></div>
    
      <script src="https://gw.alipayobjects.com/as/g/lark/site-toc/2.0.9/toc.js"></script>
<script>
  $('#page-toc').generateToc({
    contentContainer: $('.typo'),
    hasFirstLevelHeader: false,
    offsetTop: 0,
    affix: {
      bgColor: "transparent",
    },
  })
</script>

    
  

    </div>
    <div class="ant-row footer" style="background-image: linear-gradient(180deg,#050b22 0,#050b22 50%,#032158);">
  <div class="footer-content">
    <div class="ant-row footer-desc">
      <div class="ant-col-8 ant-col-offset-2 footer-team">
        <h4>我们的团队</h4>
        <p>中国，上海</p>
      </div>
      <div class="ant-col-4 ant-col-offset-2 footer-friend">
        <h4>友情链接</h4>
        <p>
          <a href="http://xujin.org">许进沉思录</a>
        </p>
        <p>
          <a href="https://springcloud.cn">Spring Cloud中国社区</a>
        </p>

      </div>
      <div class="ant-col-6 ant-col-offset-2 footer-contact">
        <h4>联系我们</h4>
        <p>业务咨询：<a href="mailto: Software_King@qq.com">Software_King@qq.com</a></p>
        <p>技术咨询：<a href="mailto: Software_King@qq.com">Software_King@qq.com</a></p>
        
      </div>
    </div>
    <div class="copyright">
      Venus Plus版权所有 &copy; 2017-2020 Venus中间件团队体系  Powered by xujin.org
    </div>
  </div>
</div>


    
    <div style="display: none">
    <script src="https://s19.cnzz.com/z_stat.php?id=1268345961&web_id=1268345961" language="JavaScript"></script>
    </div>
    
    <script>
    window.SupportConfig = {
      appId: "5a027aa32cfc95272917b0c6",
      host: "https://links.test.alipay.net/",
      bottom: "20px",
      right: "50px",
      opacity: 1
    }
    
      
      
    
    
      
      
    
  </script>
  <script>function l(){var t=d.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://links.test.alipay.net/init.js?_=1";var e=d.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}var w=window,d=document,i=function(){i.c(arguments)};i.q=[],i.c=function(t){i.q.push(t)},w.SupportNs=i,w.attachEvent?w.attachEvent("onload",l):w.addEventListener("load",l,!1);</script>
  </body>
</html>


